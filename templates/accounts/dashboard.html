{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}

<div class="col-6 col-md-4 col-lg-3 mb-3"></div>

<div class="row">
  {% for tool in tools %}
    <div class="col-6 col-md-4 col-lg-3 mb-3">

      {% if tool.status == "active" %}
        <a href="{% url tool.url %}" class="tool-tile">
          <i class="bi {{ tool.icon }}"></i>
          <span>{{ tool.name }}</span>
        </a>
      {% endif %}
      {% if tool.status == "planned" %}
      <div class="opacity-80">  
        <span class="badge bg-secondary">WKRÓTCE</span>
      </div>
      {% endif %} 
    </div>
  {% empty %}
    <div class="text-muted">
      Brak dostępnych narzędzi dla tej area.
    </div>
  {% endfor %}
</div>



{% if area_info %}

<hr class="my-4">

<h5 class="section-title mb-3">Area Info</h5>

<div class="card">
  <div class="card-body">

    <div class="d-flex justify-content-between align-items-start">

      <div>
        <strong>
          {% if area_info.updated_by.first_name %}
            {{ area_info.updated_by.first_name }}
          {% else %}
            {{ area_info.updated_by.email }}
          {% endif %}
        </strong>

        <span class="text-muted small ms-2">
          {{ area_info.updated_at|date:"d.m.Y H:i" }}
        </span>
      </div>

      {% if request.user|can:"edit_area_info" %}
        <a href="{% url 'edit_area_info' %}"
           class="btn btn-sm btn-outline-light">
          Edytuj
        </a>
      {% endif %}

    </div>

    <p class="mt-2 mb-0">
      {{ area_info.content|linebreaksbr }}
    </p>

  </div>
</div>

{% endif %}


{% if new_user_credentials %}

<div class="modal fade" id="newUserModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Nowe konto utworzone</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">

        <p><strong>Email:</strong></p>
        <input id="newUserEmail"
               class="form-control mb-3"
               value="{{ new_user_credentials.email }}"
               readonly>

        <p><strong>Hasło tymczasowe:</strong></p>
        <div class="input-group">
          <input id="newUserPassword"
                 class="form-control"
                 value="{{ new_user_credentials.password }}"
                 readonly>

          <button class="btn btn-outline-secondary"
                  type="button"
                  onclick="copyPassword()">
            Kopiuj
          </button>
        </div>

        <small class="text-muted mt-2 d-block">
          Hasło pokaże się tylko raz.
        </small>

      </div>

      <div class="modal-footer">
        <button class="btn btn-primary" data-bs-dismiss="modal">
          OK
        </button>
      </div>

    </div>
  </div>
</div>

{% endif %}


{% endblock %}
{% block scripts %}

{% if new_user_credentials %}
<script>
function copyPassword() {
  const input = document.getElementById("newUserPassword");
  input.select();
  input.setSelectionRange(0, 99999);
  navigator.clipboard.writeText(input.value);
}

window.addEventListener("DOMContentLoaded", () => {
  const modal = new bootstrap.Modal(
    document.getElementById("newUserModal")
  );
  modal.show();
});
</script>
{% endif %}

{% endblock %}
